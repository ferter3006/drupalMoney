<?php

/**
 * @file
 * Hooks para el módulo MoneyLink Tiquets.
 */

/**
 * Implements hook_theme().
 */
function moneylink_tiquets_theme($existing, $type, $theme, $path) {
  return [
    'moneylink_tiquets_create_form' => [
      'render element' => 'form',
      'template' => 'moneylink-tiquets-create-form',
      'path' => $path . '/templates',
    ],
  ];
}

/**
 * Implements hook_page_attachments().
 */
function moneylink_tiquets_page_attachments(array &$attachments) {
  // Agregar CSS global para ocultar títulos en todas las páginas del módulo
  $current_path = \Drupal::service('path.current')->getPath();
  if (strpos($current_path, '/ml/tiquets') === 0) {
    $attachments['#attached']['library'][] = 'moneylink_tiquets/global';
  }
  
  // Agregar CSS global de layout en todas las páginas de MoneyLink
  if (strpos($current_path, '/ml/') === 0) {
    $attachments['#attached']['library'][] = 'moneylink_tiquets/global_layout';
    
    // Extender la sesión en páginas MoneyLink si el usuario está autenticado
    if (\Drupal::currentUser()->isAuthenticated()) {
      $session = \Drupal::request()->getSession();
      if ($session->isStarted()) {
        // Actualizar el timestamp de la sesión para mantenerla activa
        $session->set('last_activity', time());
      }
    }
  }
}

/**
 * Implements hook_user_login().
 */
function moneylink_tiquets_user_login($account) {
  // Log cuando un usuario hace login para debug
  \Drupal::logger('moneylink_session')->info('Usuario @user logueado. Session ID: @session', [
    '@user' => $account->getAccountName(),
    '@session' => session_id(),
  ]);
}